{"version":3,"file":"vue-i18n-extract.umd.js","sources":["../src/config-file/vue-i18n-extract.config.ts","../src/config-file/index.ts","../src/create-report/vue-files.ts","../src/create-report/language-files.ts","../src/create-report/report.ts","../src/create-report/index.ts","../src/index.ts"],"sourcesContent":["export default {\r\n  // Options documented in vue-i18n-extract readme.\r\n  vueFiles: './src/**/*.?(js|vue)',\r\n  languageFiles: './lang/**/*.?(json|yaml|yml|js)',\r\n  output: false,\r\n  add: false,\r\n  remove: false,\r\n  ci: false,\r\n  separator: '.'\r\n};\r\n","import cac from 'cac';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport defaultConfig from './vue-i18n-extract.config';\r\n\r\nexport function initCommand(): void {\r\n  fs.writeFileSync(\r\n    path.resolve(process.cwd(), './vue-i18n-extract.config.js'),\r\n    `module.exports = ${JSON.stringify(defaultConfig, null, 2)}`,\r\n  );\r\n}\r\n\r\nexport function resolveConfig (): Record<string, string>  {\r\n  const argvOptions = cac().parse(process.argv, { run: false }).options;\r\n\r\n  try {\r\n    const pathToConfigFile = path.resolve(process.cwd(), './vue-i18n-extract.config.js');\r\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\r\n    const configFile = require(pathToConfigFile);\r\n\r\n    console.info(`\\nUsing config file found at ${pathToConfigFile}`);\r\n\r\n    return {\r\n      ...configFile,\r\n      ...argvOptions\r\n    };\r\n  } catch {\r\n    return argvOptions;\r\n  }\r\n}\r\n","import { SimpleFile, I18NItemWithBounding } from '../types';\r\nimport isValidGlob from 'is-valid-glob';\r\nimport glob from 'glob';\r\nimport fs from 'fs';\r\n\r\nexport function readVueFiles (src: string): SimpleFile[] {\r\n  if (!isValidGlob(src)) {\r\n    throw new Error(`vueFiles isn't a valid glob pattern.`);\r\n  }\r\n\r\n  const targetFiles = glob.sync(src);\r\n\r\n  if (targetFiles.length === 0) {\r\n    throw new Error('vueFiles glob has no files.');\r\n  }\r\n\r\n  return targetFiles.map((f) => {\r\n    const fileName = f.replace(process.cwd(), '.');\r\n    return { fileName, path: f, content: fs.readFileSync(f, 'utf8') };\r\n  });\r\n}\r\n\r\nfunction* getMatches (file: SimpleFile, regExp: RegExp, captureGroup = 1): IterableIterator<I18NItemWithBounding> {\r\n  while (true) {\r\n    const match = regExp.exec(file.content);\r\n    if (match === null) {\r\n      break;\r\n    }\r\n    const path = match[captureGroup];\r\n\r\n    const pathAtIndex = file.content.indexOf(path);\r\n    const previousCharacter = file.content.charAt(pathAtIndex - 1);\r\n    const nextCharacter = file.content.charAt(pathAtIndex + path.length);\r\n\r\n    const line = (file.content.substring(0, match.index).match(/\\n/g) || []).length + 1;\r\n    yield {\r\n      path,\r\n      previousCharacter,\r\n      nextCharacter,\r\n      file: file.fileName,\r\n      line,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Extracts translation keys from methods such as `$t` and `$tc`.\r\n *\r\n * - **regexp pattern**: (?:[$\\s.:\"'`+\\(\\[\\{]t[cm]?)\\(\r\n *\r\n *   **description**: Matches the sequence t(, tc( or tm(, optionally with either “$”, SPACE, “.”, “:”, “\"”, “'”,\r\n *   “`”, \"+\", \"(\", \"[\" or \"{\" in front of it.\r\n *\r\n * - **regexp pattern**: ([\"'`])\r\n *\r\n *   **description**: 1. capturing group. Matches either “\"”, “'”, or “`”.\r\n *\r\n * - **regexp pattern**: ((?:[^\\\\]|\\\\.)*?)\r\n *\r\n *   **description**: 2. capturing group. Matches anything except a backslash\r\n *   *or* matches any backslash followed by any character (e.g. “\\\"”, “\\`”, “\\t”, etc.)\r\n *\r\n * - **regexp pattern**: \\1\r\n *\r\n *   **description**: matches whatever was matched by capturing group 1 (e.g. the starting string character)\r\n *\r\n * @param file a file object\r\n * @returns a list of translation keys found in `file`.\r\n */\r\n function extractMethodMatches (file: SimpleFile): I18NItemWithBounding[] {\r\n  const methodRegExp = /(?:[$\\s.:\"'`+\\(\\[\\{]t[cm]?)\\(\\s*?([\"'`])((?:[^\\\\]|\\\\.)*?)\\1/g;\r\n  return [ ...getMatches(file, methodRegExp, 2) ];\r\n}\r\n\r\nfunction extractComponentMatches (file: SimpleFile): I18NItemWithBounding[] {\r\n  const componentRegExp = /(?:<(?:i18n|Translation))(?:.|\\n)*?(?:[^:]path=(\"|'))((?:[^\\\\]|\\\\.)*?)\\1/gi;\r\n  return [ ...getMatches(file, componentRegExp, 2) ];\r\n}\r\n\r\nfunction extractDirectiveMatches (file: SimpleFile): I18NItemWithBounding[] {\r\n  const directiveRegExp = /v-t=\"'((?:[^\\\\]|\\\\.)*?)'\"/g;\r\n  return [ ...getMatches(file, directiveRegExp) ];\r\n}\r\n\r\nexport function extractI18NItemsFromVueFiles (sourceFiles: SimpleFile[]): I18NItemWithBounding[] {\r\n  return sourceFiles.reduce((accumulator, file) => {\r\n    const methodMatches = extractMethodMatches(file);\r\n    const componentMatches = extractComponentMatches(file);\r\n    const directiveMatches = extractDirectiveMatches(file);\r\n    return [\r\n      ...accumulator,\r\n      ...methodMatches,\r\n      ...componentMatches,\r\n      ...directiveMatches,\r\n    ];\r\n  }, [] as I18NItemWithBounding[]);\r\n}\r\n\r\n// This is a convenience function for users implementing in their own projects, and isn't used internally\r\nexport function parseVueFiles (vueFiles: string): I18NItemWithBounding[] {\r\n  return extractI18NItemsFromVueFiles(readVueFiles(vueFiles));\r\n}\r\n","import path from 'path';\r\nimport fs from 'fs';\r\nimport glob from 'glob';\r\nimport Dot from 'dot-object';\r\nimport yaml from 'js-yaml';\r\nimport isValidGlob from 'is-valid-glob';\r\nimport { SimpleFile, I18NLanguage, I18NItem } from '../types';\r\n\r\nexport function readLanguageFiles (src: string): SimpleFile[] {\r\n  if (!isValidGlob(src)) {\r\n    throw new Error(`languageFiles isn't a valid glob pattern.`);\r\n  }\r\n\r\n  const targetFiles = glob.sync(src);\r\n\r\n  if (targetFiles.length === 0) {\r\n    throw new Error('languageFiles glob has no files.');\r\n  }\r\n\r\n  return targetFiles.map(f => {\r\n    const langPath = path.resolve(process.cwd(), f);\r\n\r\n    const extension = langPath.substring(langPath.lastIndexOf('.')).toLowerCase();\r\n    const isJSON = extension === '.json';\r\n    const isYAML = extension === '.yaml' || extension === '.yml';\r\n\r\n    let langObj;\r\n    if (isJSON) {\r\n      langObj = JSON.parse(fs.readFileSync(langPath, 'utf8'));\r\n    } else if (isYAML) {\r\n      langObj = yaml.load(fs.readFileSync(langPath, 'utf8'));\r\n    } else {\r\n      langObj = eval(fs.readFileSync(langPath, 'utf8'));\r\n    }\r\n\r\n    const fileName = f.replace(process.cwd(), '.');\r\n\r\n    return { path: f, fileName, content: JSON.stringify(langObj) };\r\n  });\r\n}\r\n\r\nexport function extractI18NLanguageFromLanguageFiles (languageFiles: SimpleFile[], dot: DotObject.Dot = Dot): I18NLanguage {\r\n  return languageFiles.reduce((accumulator, file) => {\r\n    const language = file.fileName.substring(file.fileName.lastIndexOf('/') + 1, file.fileName.lastIndexOf('.'));\r\n\r\n    if (!accumulator[language]) {\r\n      accumulator[language] = [];\r\n    }\r\n\r\n    const flattenedObject = dot.dot(JSON.parse(file.content));\r\n    Object.keys(flattenedObject).forEach((key, index) => {\r\n      accumulator[language].push({\r\n        path: key,\r\n        file: file.fileName,\r\n        line: index,\r\n      });\r\n    });\r\n\r\n    return accumulator;\r\n  }, {});\r\n}\r\n\r\nexport function writeMissingToLanguageFiles (parsedLanguageFiles: SimpleFile[], missingKeys: I18NItem[], dot: DotObject.Dot = Dot): void {\r\n  parsedLanguageFiles.forEach(languageFile => {\r\n    const languageFileContent = JSON.parse(languageFile.content);\r\n\r\n    missingKeys.forEach(item => {\r\n      if (item.language && languageFile.fileName.includes(item.language) || !item.language) {\r\n        dot.str(item.path, item.path, languageFileContent);\r\n      }\r\n    });\r\n\r\n    writeLanguageFile(languageFile, languageFileContent);\r\n  });\r\n}\r\n\r\nexport function removeUnusedFromLanguageFiles (parsedLanguageFiles: SimpleFile[], unusedKeys: I18NItem[], dot: DotObject.Dot = Dot): void {\r\n  parsedLanguageFiles.forEach(languageFile => {\r\n    const languageFileContent = JSON.parse(languageFile.content);\r\n\r\n    unusedKeys.forEach(item => {\r\n      if (item.language && languageFile.fileName.includes(item.language)) {\r\n        dot.delete(item.path, languageFileContent);\r\n      }\r\n    });\r\n\r\n    writeLanguageFile(languageFile, languageFileContent);\r\n  });\r\n}\r\n\r\nfunction writeLanguageFile (languageFile: SimpleFile, newLanguageFileContent: unknown) {\r\n  const fileExtension = languageFile.fileName.substring(languageFile.fileName.lastIndexOf('.') + 1);\r\n    const filePath = languageFile.path;\r\n    const stringifiedContent = JSON.stringify(newLanguageFileContent, null, 2);\r\n\r\n    if (fileExtension === 'json') {\r\n      fs.writeFileSync(filePath, stringifiedContent);\r\n    } else if (fileExtension === 'js') {\r\n      const jsFile = `module.exports = ${stringifiedContent}; \\n`;\r\n      fs.writeFileSync(filePath, jsFile);\r\n    } else if (fileExtension === 'yaml' || fileExtension === 'yml') {\r\n      const yamlFile = yaml.dump(newLanguageFileContent);\r\n      fs.writeFileSync(filePath, yamlFile);\r\n    } else {\r\n      throw new Error(`Language filetype of ${fileExtension} not supported.`)\r\n    }\r\n}\r\n\r\n// This is a convenience function for users implementing in their own projects, and isn't used internally\r\nexport function parselanguageFiles (languageFiles: string, dot: DotObject.Dot = Dot): I18NLanguage {\r\n  return extractI18NLanguageFromLanguageFiles(readLanguageFiles(languageFiles), dot);\r\n}\r\n","import fs from 'fs';\r\nimport { I18NItem, I18NItemWithBounding, I18NLanguage, I18NReport } from '../types';\r\n\r\nfunction stripBounding (item: I18NItemWithBounding): I18NItem {\r\n  return {\r\n    path: item.path,\r\n    file: item.file,\r\n    line: item.line,\r\n  }\r\n}\r\n\r\nfunction mightBeDynamic (item: I18NItemWithBounding): boolean {\r\n  return item.path.includes('${') && !!item.previousCharacter.match(/`/g) && !!item.nextCharacter.match(/`/g);\r\n}\r\n\r\n// Looping through the arays multiple times might not be the most effecient, but it's the easiest to read and debug. Which at this scale is an accepted trade-off.\r\nexport function extractI18NReport (vueItems: I18NItemWithBounding[], languageFiles: I18NLanguage): I18NReport {\r\n  const missingKeys: I18NItem[] = [];\r\n  const unusedKeys: I18NItem[] = [];\r\n\r\n  const maybeDynamicKeys: I18NItem[] = vueItems\r\n    .filter(vueItem => mightBeDynamic(vueItem))\r\n    .map(vueItem => stripBounding(vueItem));\r\n\r\n  Object.keys(languageFiles).forEach(language => {\r\n    const languageItems = languageFiles[language];\r\n\r\n    const missingKeysInLanguage = vueItems\r\n      .filter(vueItem => !mightBeDynamic(vueItem))\r\n      .filter(vueItem => !languageItems.some(languageItem => vueItem.path === languageItem.path))\r\n      .map(vueItem => ({ ...stripBounding(vueItem), language }));\r\n\r\n    const unusedKeysInLanguage = languageItems\r\n      .filter(languageItem => !vueItems.some(vueItem => languageItem.path === vueItem.path || languageItem.path.startsWith(vueItem.path + '.')))\r\n      .map(languageItem => ({ ...languageItem, language }));\r\n\r\n    missingKeys.push(...missingKeysInLanguage);\r\n    unusedKeys.push(...unusedKeysInLanguage);\r\n  });\r\n\r\n  return {\r\n    missingKeys,\r\n    unusedKeys,\r\n    maybeDynamicKeys,\r\n  };\r\n}\r\n\r\nexport async function writeReportToFile (report: I18NReport, writePath: string): Promise<NodeJS.ErrnoException | void> {\r\n  const reportString = JSON.stringify(report);\r\n  return new Promise((resolve, reject) => {\r\n    fs.writeFile(\r\n      writePath,\r\n      reportString,\r\n      (err) => {\r\n        if (err) {\r\n          reject(err);\r\n          return;\r\n        }\r\n        resolve();\r\n      },\r\n    );\r\n  });\r\n}\r\n\r\n","import path from 'path';\r\nimport { ReportOptions, I18NReport } from '../types';\r\nimport { readVueFiles, extractI18NItemsFromVueFiles } from './vue-files';\r\nimport { readLanguageFiles, extractI18NLanguageFromLanguageFiles, removeUnusedFromLanguageFiles, writeMissingToLanguageFiles } from './language-files';\r\nimport { extractI18NReport,  writeReportToFile } from './report';\r\nimport Dot from 'dot-object';\r\n\r\nexport async function createI18NReport (options: ReportOptions): Promise<I18NReport> {\r\n  const {\r\n    vueFiles: vueFilesGlob,\r\n    languageFiles: languageFilesGlob,\r\n    output,\r\n    add,\r\n    remove,\r\n    ci,\r\n    separator\r\n  } = options;\r\n\r\n  if (!vueFilesGlob) throw new Error('Required configuration vueFiles is missing.');\r\n  if (!languageFilesGlob) throw new Error('Required configuration languageFiles is missing.');\r\n\r\n  const dot = typeof separator === 'string' ? new Dot(separator) : Dot;\r\n  const vueFiles = readVueFiles(path.resolve(process.cwd(), vueFilesGlob));\r\n  const languageFiles = readLanguageFiles(path.resolve(process.cwd(), languageFilesGlob));\r\n\r\n  const I18NItems = extractI18NItemsFromVueFiles(vueFiles);\r\n  const I18NLanguage = extractI18NLanguageFromLanguageFiles(languageFiles, dot);\r\n\r\n  const report = extractI18NReport(I18NItems, I18NLanguage);\r\n\r\n  if (report.missingKeys.length) console.info('\\nMissing Keys'), console.table(report.missingKeys);\r\n  if (report.unusedKeys.length) console.info('\\nUnused Keys'), console.table(report.unusedKeys);\r\n  if (report.maybeDynamicKeys.length) console.warn('\\nSuspected Dynamic Keys Found\\nvue-i18n-extract does not compile Vue templates and therefore can not infer the correct key for the following keys.'), console.table(report.maybeDynamicKeys);\r\n\r\n  if (output) {\r\n    await writeReportToFile(report, path.resolve(process.cwd(), output));\r\n    console.info(`\\nThe report has been has been saved to ${output}`);\r\n  }\r\n\r\n  if (add && report.missingKeys.length) {\r\n    writeMissingToLanguageFiles(languageFiles, report.missingKeys, dot);\r\n    console.info('\\nThe missing keys have been added to your language files.');\r\n  }\r\n  if (remove && report.unusedKeys.length) {\r\n    removeUnusedFromLanguageFiles(languageFiles, report.unusedKeys, dot);\r\n    console.info('\\nThe unused keys have been removed from your language files.');\r\n  }\r\n\r\n  if (ci && report.missingKeys.length) {\r\n    throw new Error(`${report.missingKeys.length} missing keys found.`);\r\n  }\r\n\r\n  if (ci && report.unusedKeys.length) {\r\n    throw new Error(`${report.unusedKeys.length} unused keys found.`);\r\n  }\r\n\r\n  return report;\r\n}\r\n\r\nexport * from './vue-files';\r\nexport * from './language-files';\r\nexport * from './report';\r\n","export * from './config-file';\r\nexport * from './create-report';\r\nexport * from './types';\r\n\r\nprocess.on('uncaughtException', (err) => {\r\n  console.error('[vue-i18n-extract]', err);\r\n  process.exit(1);\r\n});\r\n\r\nprocess.on('unhandledRejection', (err) => {\r\n  console.error('[vue-i18n-extract]', err);\r\n  process.exit(1);\r\n});\r\n"],"names":["vueFiles","languageFiles","output","add","remove","ci","separator","initCommand","fs","writeFileSync","path","resolve","process","cwd","JSON","stringify","defaultConfig","resolveConfig","argvOptions","cac","parse","argv","run","options","pathToConfigFile","configFile","require","console","info","readVueFiles","src","isValidGlob","Error","targetFiles","glob","sync","length","map","f","fileName","replace","content","readFileSync","getMatches","file","regExp","captureGroup","match","exec","pathAtIndex","indexOf","previousCharacter","charAt","nextCharacter","line","substring","index","extractMethodMatches","methodRegExp","extractComponentMatches","componentRegExp","extractDirectiveMatches","directiveRegExp","extractI18NItemsFromVueFiles","sourceFiles","reduce","accumulator","methodMatches","componentMatches","directiveMatches","parseVueFiles","readLanguageFiles","langPath","extension","lastIndexOf","toLowerCase","isJSON","isYAML","langObj","yaml","load","eval","extractI18NLanguageFromLanguageFiles","dot","Dot","language","flattenedObject","Object","keys","forEach","key","push","writeMissingToLanguageFiles","parsedLanguageFiles","missingKeys","languageFile","languageFileContent","item","includes","str","writeLanguageFile","removeUnusedFromLanguageFiles","unusedKeys","delete","newLanguageFileContent","fileExtension","filePath","stringifiedContent","jsFile","yamlFile","dump","parselanguageFiles","stripBounding","mightBeDynamic","extractI18NReport","vueItems","maybeDynamicKeys","filter","vueItem","languageItems","missingKeysInLanguage","some","languageItem","unusedKeysInLanguage","startsWith","writeReportToFile","report","writePath","reportString","Promise","reject","writeFile","err","createI18NReport","vueFilesGlob","languageFilesGlob","I18NItems","I18NLanguage","table","warn","on","error","exit"],"mappings":"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"}